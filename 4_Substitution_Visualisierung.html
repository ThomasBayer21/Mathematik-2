<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Substitutionsmethode</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .description {
            background: #f8fafc;
            padding: 15px;
            border-left: 3px solid #e2e8f0;
            margin-bottom: 20px;
            border-radius: 3px;
        }
        .example-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .example-btn {
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 12px;
            font-size: 13px;
            transition: background 0.3s;
        }
        .example-btn:hover {
            background: #1e40af;
        }
        .control-group {
            position: relative;
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        canvas {
            border: 2px solid #f39c12;
            border-radius: 5px;
            width: 100%;
            background: white;
        }
        .canvas-container {
            text-align: center;
        }
        .canvas-title {
            font-size: 18px;
            font-weight: bold;
            color: #64748b;
            margin-bottom: 10px;
        }
        .transformation-arrow {
            text-align: center;
            font-size: 48px;
            color: #64748b;
            margin: 20px 0;
        }
        .explanation {
            background: #f8fafc;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .step {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-left: 3px solid #e2e8f0;
            border-radius: 5px;
        }
        .formula {
            font-size: 18px;
            font-weight: bold;
            color: #e74c3c;
            margin: 10px 0;
            text-align: center;
            padding: 15px;
            background: #fff5f5;
            border-radius: 5px;
        }
        select {
            padding: 8px;
            border: 2px solid #f39c12;
            border-radius: 5px;
            font-size: 14px;
            width: 100%;
        }
        .highlight {
            background: #f8fafc;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        .interpretation {
            background: #f8fafc;
            padding: 15px;
            border-left: 3px solid #e2e8f0;
            margin: 15px 0;
            border-radius: 3px;
        }
        .interpretation h3 {
            margin-top: 0;
            color: #64748b;
            font-size: 16px;
        }
        .tips-section {
            background: #f8fafc;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .tips-section h3 {
            margin-top: 0;
            color: #2563eb;
            font-size: 16px;
        }
        .tips-section ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .tips-section li {
            margin: 8px 0;
            line-height: 1.5;
        }
        .difficulty {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .difficulty-easy { background: #d4edda; color: #155724; }
        .difficulty-medium { background: #f8fafc; color: #64748b; }
        .difficulty-hard { background: #f8d7da; color: #721c24; }
        .pattern-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .pattern-box h4 {
            margin-top: 0;
            color: #64748b;
        }
        .transformation-demo {
            background: #f8fafc;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        .transform-box {
            background: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            border: 3px solid #2563eb;
            min-width: 150px;
        }
        .transform-box.highlight {
            background: #f8fafc;
            border-color: #64748b;
        }
        .transform-arrow-big {
            font-size: 36px;
            color: #2563eb;
            font-weight: bold;
        }
        .slider-control {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .value-display {
            font-size: 18px;
            font-weight: bold;
            color: #e74c3c;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Substitutionsmethode Visualisierung</h1>

        <div class="description">
            <strong>Was ist Substitution?</strong> Die Substitution ist eine Integrationstechnik, die ein kompliziertes Integral durch Variablenwechsel (u = g(x)) in ein einfacheres transformiert.
            <br><br>
            <strong>Grundidee:</strong> Ersetze u = g(x) und du = g'(x)dx. Dann wird ∫ f(g(x))·g'(x) dx = ∫ f(u) du
        </div>

        <div class="example-buttons">
            <button class="example-btn" onclick="loadExample('1')">Beispiel 1: Exponentialfunktion</button>
            <button class="example-btn" onclick="loadExample('2')">Beispiel 2: Trigonometrisch</button>
            <button class="example-btn" onclick="loadExample('3')">Beispiel 3: Wurzelfunktion</button>
        </div>

        <div class="control-group">
            <label>Wähle ein Beispiel:</label>
            <select id="example">
                <option value="1">Beispiel 1: e^(x²) mit 2x</option>
                <option value="2">Beispiel 2: cos(x)·sin(x)</option>
                <option value="3">Beispiel 3: x·√(1+x²)</option>
            </select>
        </div>

        <div class="interpretation" id="whySubstitution">
            <!-- Wird dynamisch gefüllt -->
        </div>

        <div class="slider-control">
            <label style="display: block; margin-bottom: 10px;">
                <strong>Interaktive Transformation:</strong> Bewege den Slider, um zu sehen wie sich ein x-Wert in u transformiert
            </label>
            <input type="range" id="xSlider" min="0" max="100" value="50" style="width: 100%;">
            <div class="transformation-demo">
                <div class="transform-box highlight">
                    <div style="color: #7f8c8d; font-size: 12px;">x-Wert</div>
                    <div class="value-display" id="xValue">0</div>
                    <div style="color: #7f8c8d; font-size: 12px;">Original-Variable</div>
                </div>
                <div class="transform-arrow-big">→</div>
                <div class="transform-box" style="border-color: #64748b; background: #f8fafc;">
                    <div style="color: #7f8c8d; font-size: 12px;">Substitution</div>
                    <div style="font-weight: bold; color: #64748b; margin: 5px 0;" id="substitutionFormula">u = x²</div>
                </div>
                <div class="transform-arrow-big">→</div>
                <div class="transform-box highlight">
                    <div style="color: #7f8c8d; font-size: 12px;">u-Wert</div>
                    <div class="value-display" id="uValue">0</div>
                    <div style="color: #7f8c8d; font-size: 12px;">Neue Variable</div>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="canvas-container">
                <div class="canvas-title">Vorher: f(g(x))·g'(x)</div>
                <canvas id="canvas1" width="600" height="400"></canvas>
                <div style="margin-top: 10px; color: #7f8c8d; font-size: 13px;">Komplizierte Funktion in x</div>
            </div>
            <div class="canvas-container">
                <div class="canvas-title">Nachher: f(u)</div>
                <canvas id="canvas2" width="600" height="400"></canvas>
                <div style="margin-top: 10px; color: #7f8c8d; font-size: 13px;">Vereinfachte Funktion in u</div>
            </div>
        </div>

        <div class="transformation-arrow">⬇️</div>

        <div class="explanation" id="explanation">
            <!-- Wird dynamisch gefüllt -->
        </div>

        <div class="pattern-box">
            <h4>Erkennungsmuster für diese Substitution</h4>
            <div id="patternInfo"></div>
        </div>

        <div class="tips-section">
            <h3>Allgemeine Tipps zur Substitution</h3>
            <ul>
                <li><strong>Innere Funktion finden:</strong> Suche nach g(x) und prüfe, ob g'(x) auch im Integral vorkommt (eventuell mit Konstanten-Faktor)</li>
                <li><strong>Häufige Muster:</strong>
                    <ul>
                        <li>∫ f(g(x))·g'(x) dx → u = g(x) ist die "innere Funktion"</li>
                        <li>Bei Polynomen im Exponenten/Argument: u = Polynom</li>
                        <li>Bei zusammengesetzten trig. Funktionen: u = innere Funktion</li>
                    </ul>
                </li>
                <li><strong>Ableitung prüfen:</strong> Berechne du/dx und schaue, ob du = g'(x)dx im Integral vorkommt</li>
                <li><strong>Anpassung:</strong> Manchmal muss man Konstanten anpassen (z.B. 2x vorhanden, aber nur x gebraucht → Faktor ½ vor das Integral)</li>
                <li><strong>Grenzen:</strong> Bei bestimmten Integralen: Entweder Grenzen mittransformieren oder am Ende rücksubstituieren</li>
                <li><strong>Rücksubstitution:</strong> Nicht vergessen, am Ende u wieder durch g(x) zu ersetzen!</li>
            </ul>
        </div>

        <div class="tips-section" style="background: #f8fafc;">
            <h3>Wann welche Substitution?</h3>
            <ul>
                <li><strong>u = x^n:</strong> Wenn du Polynom im Exponenten oder als Argument hast</li>
                <li><strong>u = sin(x) oder cos(x):</strong> Bei Produkten von Sinus und Kosinus</li>
                <li><strong>u = e^x:</strong> Manchmal bei Quotienten mit e^x</li>
                <li><strong>u = ln(x):</strong> Bei Brüchen mit 1/x im Zähler</li>
                <li><strong>u = 1 + x^2:</strong> Bei Wurzeln oder Brüchen mit 1 + x^2</li>
            </ul>
        </div>
    </div>

    <script>
        const canvas1 = document.getElementById('canvas1');
        const canvas2 = document.getElementById('canvas2');
        const ctx1 = canvas1.getContext('2d');
        const ctx2 = canvas2.getContext('2d');
        const exampleSelect = document.getElementById('example');
        const xSlider = document.getElementById('xSlider');

        let currentX = 0;
        let currentU = 0;

        const examples = {
            '1': {
                original: {
                    f: x => 2 * x * Math.exp(x * x),
                    label: '2x·e^(x²)',
                    xMin: -2, xMax: 2,
                    yMin: -5, yMax: 20
                },
                substituted: {
                    f: u => Math.exp(u),
                    label: 'e^u',
                    uMin: 0, uMax: 4,
                    yMin: 0, yMax: 60
                },
                uFunc: x => x * x,
                uFormula: 'u = x²',
                steps: [
                    'Gegeben: ∫ 2x·e^(x²) dx',
                    'Schritt 1: Setze <span class="highlight">u = x²</span> (innere Funktion)',
                    'Schritt 2: Dann du/dx = 2x, also <span class="highlight">du = 2x dx</span>',
                    'Schritt 3: Ersetze: ∫ e^(x²)·(2x dx) = ∫ e^u du',
                    'Schritt 4: Integriere: ∫ e^u du = <span class="highlight">e^u + C</span>',
                    'Schritt 5: Rücksubstitution: e^u + C = <span class="highlight">e^(x²) + C</span>'
                ],
                integral: 'e^(x²) + C',
                difficulty: 'easy',
                why: 'Die Ableitung der inneren Funktion x² ist 2x - genau der Faktor, der vor dem e^(x²) steht! Das ist das perfekte Erkennungsmuster für Substitution.',
                pattern: '<strong>Muster:</strong> f(x²)·2x → Setze u = x²<br><strong>Warum?</strong> Die Ableitung von x² ist 2x, was genau als Faktor im Integral vorkommt.'
            },
            '2': {
                original: {
                    f: x => Math.cos(x) * Math.sin(x),
                    label: 'cos(x)·sin(x)',
                    xMin: 0, xMax: 6.28,
                    yMin: -1, yMax: 1
                },
                substituted: {
                    f: u => u,
                    label: 'u',
                    uMin: -1, uMax: 1,
                    yMin: -1, yMax: 1
                },
                uFunc: x => Math.sin(x),
                uFormula: 'u = sin(x)',
                steps: [
                    'Gegeben: ∫ cos(x)·sin(x) dx',
                    'Schritt 1: Setze <span class="highlight">u = sin(x)</span> (eine der Funktionen)',
                    'Schritt 2: Dann du/dx = cos(x), also <span class="highlight">du = cos(x) dx</span>',
                    'Schritt 3: Ersetze: ∫ sin(x)·(cos(x) dx) = ∫ u du',
                    'Schritt 4: Integriere: ∫ u du = <span class="highlight">u²/2 + C</span>',
                    'Schritt 5: Rücksubstitution: u²/2 + C = <span class="highlight">sin²(x)/2 + C</span>'
                ],
                integral: 'sin²(x)/2 + C',
                difficulty: 'easy',
                why: 'Bei sin(x)·cos(x) ist die Ableitung von sin(x) gleich cos(x). Daher können wir u = sin(x) setzen und der Rest des Integrals "passt perfekt".',
                pattern: '<strong>Muster:</strong> sin(x)·cos(x) → Setze u = sin(x)<br><strong>Warum?</strong> Die Ableitung von sin(x) ist cos(x), der andere Faktor im Produkt. Alternative: u = cos(x) würde auch funktionieren!'
            },
            '3': {
                original: {
                    f: x => x * Math.sqrt(1 + x * x),
                    label: 'x·√(1+x²)',
                    xMin: -3, xMax: 3,
                    yMin: 0, yMax: 10
                },
                substituted: {
                    f: u => 0.5 * Math.sqrt(u),
                    label: '½·√u',
                    uMin: 1, uMax: 10,
                    yMin: 0, yMax: 2
                },
                uFunc: x => 1 + x * x,
                uFormula: 'u = 1 + x²',
                steps: [
                    'Gegeben: ∫ x·√(1+x²) dx',
                    'Schritt 1: Setze <span class="highlight">u = 1 + x²</span> (Ausdruck unter der Wurzel)',
                    'Schritt 2: Dann du/dx = 2x, also <span class="highlight">x dx = du/2</span>',
                    'Schritt 3: Ersetze: ∫ √(1+x²)·(x dx) = ∫ √u · (du/2) = ½∫ u^(½) du',
                    'Schritt 4: Integriere: ½∫ u^(½) du = ½·(2/3)u^(3/2) + C = <span class="highlight">u^(3/2)/3 + C</span>',
                    'Schritt 5: Rücksubstitution: <span class="highlight">(1+x²)^(3/2)/3 + C</span>'
                ],
                integral: '(1+x²)^(3/2)/3 + C',
                difficulty: 'medium',
                why: 'Der Ausdruck 1+x² steht unter der Wurzel. Seine Ableitung ist 2x, und wir haben x als Faktor - fast perfekt! Wir müssen nur den Faktor 2 durch ½ vor das Integral ausgleichen.',
                pattern: '<strong>Muster:</strong> x·√(1+x²) → Setze u = 1+x²<br><strong>Warum?</strong> Die Ableitung von 1+x² ist 2x. Wir haben x, müssen also einen Faktor ½ ergänzen.'
            }
        };

        function drawGraph(ctx, func, xMin, xMax, yMin, yMax, label, markerX = null, markerY = null) {
            const width = ctx.canvas.width;
            const height = ctx.canvas.height;
            const padding = 50;

            ctx.clearRect(0, 0, width, height);

            // Hilfsfunktionen
            const toCanvasX = (x) => padding + (x - xMin) / (xMax - xMin) * (width - 2 * padding);
            const toCanvasY = (y) => height - padding - (y - yMin) / (yMax - yMin) * (height - 2 * padding);

            // Gitter
            ctx.strokeStyle = '#ecf0f1';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const x = xMin + (xMax - xMin) * i / 10;
                ctx.beginPath();
                ctx.moveTo(toCanvasX(x), padding);
                ctx.lineTo(toCanvasX(x), height - padding);
                ctx.stroke();
            }

            // Achsen
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;

            ctx.beginPath();
            ctx.moveTo(padding, toCanvasY(0));
            ctx.lineTo(width - padding, toCanvasY(0));
            ctx.stroke();

            if (xMin <= 0 && xMax >= 0) {
                ctx.beginPath();
                ctx.moveTo(toCanvasX(0), padding);
                ctx.lineTo(toCanvasX(0), height - padding);
                ctx.stroke();
            }

            // Funktion zeichnen
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.beginPath();

            let started = false;
            for (let x = xMin; x <= xMax; x += (xMax - xMin) / 500) {
                const y = func(x);
                if (y >= yMin && y <= yMax && !isNaN(y) && isFinite(y)) {
                    const cx = toCanvasX(x);
                    const cy = toCanvasY(y);

                    if (!started) {
                        ctx.moveTo(cx, cy);
                        started = true;
                    } else {
                        ctx.lineTo(cx, cy);
                    }
                }
            }
            ctx.stroke();

            // Zeichne Markierung wenn vorhanden
            if (markerX !== null && markerX >= xMin && markerX <= xMax) {
                const yValue = func(markerX);
                if (yValue >= yMin && yValue <= yMax && !isNaN(yValue) && isFinite(yValue)) {
                    // Vertikale Linie
                    ctx.strokeStyle = '#2563eb';
                    ctx.setLineDash([5, 5]);
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(toCanvasX(markerX), toCanvasY(0));
                    ctx.lineTo(toCanvasX(markerX), toCanvasY(yValue));
                    ctx.stroke();
                    ctx.setLineDash([]);

                    // Punkt auf der Kurve
                    ctx.fillStyle = '#2563eb';
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(toCanvasX(markerX), toCanvasY(yValue), 7, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.stroke();

                    // Label
                    ctx.fillStyle = '#2563eb';
                    ctx.font = 'bold 14px Arial';
                    ctx.fillText(`(${markerX.toFixed(2)}, ${yValue.toFixed(2)})`, toCanvasX(markerX) + 10, toCanvasY(yValue) - 10);
                }
            }

            // Label
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('f = ' + label, 10, 25);
        }

        function updateExplanation(steps, result) {
            const explanation = document.getElementById('explanation');
            let html = '<h3>Schritt-für-Schritt Lösung:</h3>';

            steps.forEach((step, index) => {
                html += `<div class="step">${step}</div>`;
            });

            html += `<div class="formula">Endergebnis: ∫ f(x) dx = ${result}</div>`;

            explanation.innerHTML = html;
        }

        function updateInterpretation(ex) {
            const why = document.getElementById('whySubstitution');
            const difficultyClass = 'difficulty-' + ex.difficulty;
            const difficultyText = {
                'easy': 'Einfach',
                'medium': 'Mittel',
                'hard': 'Schwierig'
            };

            let html = '<h3>Warum funktioniert diese Substitution?</h3>';
            html += `<p>${ex.why}</p>`;
            html += `<p><strong>Schwierigkeit:</strong> <span class="difficulty ${difficultyClass}">${difficultyText[ex.difficulty]}</span></p>`;

            why.innerHTML = html;

            // Pattern info
            document.getElementById('patternInfo').innerHTML = ex.pattern;
        }

        function updateSlider() {
            const exKey = exampleSelect.value;
            const ex = examples[exKey];

            const sliderValue = parseInt(xSlider.value);
            currentX = ex.original.xMin + (ex.original.xMax - ex.original.xMin) * (sliderValue / 100);
            currentU = ex.uFunc(currentX);

            document.getElementById('xValue').textContent = currentX.toFixed(2);
            document.getElementById('uValue').textContent = currentU.toFixed(2);
            document.getElementById('substitutionFormula').textContent = ex.uFormula;

            draw();
        }

        function draw() {
            const exKey = exampleSelect.value;
            const ex = examples[exKey];

            // Original zeichnen mit Markierung
            drawGraph(
                ctx1,
                ex.original.f,
                ex.original.xMin,
                ex.original.xMax,
                ex.original.yMin,
                ex.original.yMax,
                ex.original.label,
                currentX
            );

            // Substituiert zeichnen mit Markierung
            drawGraph(
                ctx2,
                ex.substituted.f,
                ex.substituted.uMin,
                ex.substituted.uMax,
                ex.substituted.yMin,
                ex.substituted.yMax,
                ex.substituted.label,
                currentU
            );

            updateExplanation(ex.steps, ex.integral);
            updateInterpretation(ex);
        }

        function loadExample(num) {
            exampleSelect.value = num;
            updateSlider();
        }

        exampleSelect.addEventListener('change', () => {
            updateSlider();
        });

        xSlider.addEventListener('input', updateSlider);

        // Initiale Darstellung
        updateSlider();
    </script>
</body>
</html>
